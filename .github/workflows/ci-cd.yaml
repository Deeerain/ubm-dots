name: Simple Arch Build

on:
  push:
    tags: ['v*']
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: üì• Checkout repository
      uses: actions/checkout@v4
      
    - name: üèóÔ∏è Build Arch Linux package
      run: |
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–∞–≤–∞–º–∏
        docker run --rm \
          -v "$(pwd):/source" \
          -w /build \
          archlinux:latest \
          bash -c "
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã
            pacman -Syu --noconfirm --needed base-devel git
            
            # –ö–æ–ø–∏—Ä—É–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
            cp -r /source/. /build/
            
            # –°–æ–±–∏—Ä–∞–µ–º –ø–∞–∫–µ—Ç (–æ—Ç –∏–º–µ–Ω–∏ root, –Ω–æ —Å —Ñ–ª–∞–≥–æ–º --nocheck)
            cd /build
            makepkg --syncdeps --noconfirm --clean
            
            # –ö–æ–ø–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ
            cp *.pkg.tar.zst /source/ 2>/dev/null || echo '–ü–∞–∫–µ—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω'
          "
          
    - name: üì§ Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: "*.pkg.tar.zst"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
