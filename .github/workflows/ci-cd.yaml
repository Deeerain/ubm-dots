name: Simple Arch Build

on:
  pull_request:
    branches: ['main']
  workflow_dispatch:

permissions:
  contents: write
  packages: write
  actions: read

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: üêã Build with Docker
      run: |
        # –°–Ω–∞—á–∞–ª–∞ –¥–∞–µ–º –ø–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
        chmod 777 "$PWD" || true
        
        # –°–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑
        docker build -t pkg-builder -f Dockerfile .
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ volume mount
        docker run --rm \
          -v "$PWD:/build:rw" \
          -w /build \
          pkg-builder
        
    - name: üì¶ Check result
      run: |
        echo "–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
        ls -la *.pkg.tar.* 2>/dev/null || echo "–§–∞–π–ª—ã –ø–∞–∫–µ—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
        
        if [ -f *.pkg.tar.zst ]; then
          echo "‚úÖ –ü–∞–∫–µ—Ç —Å–æ–∑–¥–∞–Ω: $(ls *.pkg.tar.zst)"
        else
          echo "‚ùå –ü–∞–∫–µ—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω"
          exit 1
        fi
        
    - name: üöÄ Create release
      uses: softprops/action-gh-release@v1
      with:
        files: "*.pkg.tar.zst"
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
